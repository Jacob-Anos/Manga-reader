<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manga / Manhwa Tracker – PWA</title>
  <meta name="theme-color" content="#151835" />
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MangaTracker">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="icon" type="image/png" href="icon-192.png">
  <style>
    :root{--bg:#0f1220;--card:#151835;--muted:#8ea3c2;--text:#e8eeff;--accent:#6ea8ff;--danger:#ff7a7a;}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:16px 14px 120px}
    header{position:sticky;top:0;background:linear-gradient(180deg,rgba(15,18,32,.98),rgba(15,18,32,.85),rgba(15,18,32,0));backdrop-filter:blur(6px);padding:10px 0;margin-bottom:10px}
    h1{font-size:22px;margin:0 0 6px}
    .muted{color:var(--muted);font-size:13px}
    input,button,select{border:none;outline:none;border-radius:10px;padding:8px 10px;background:#1b1f3b;color:white}
    button{cursor:pointer}
    .card{background:var(--card);border-radius:10px;padding:14px;margin:8px 0}
    .grid{display:grid;gap:10px}
    @media(min-width:700px){.grid{grid-template-columns:1fr 1fr}}
    .item{display:flex;flex-direction:column;gap:10px}
    .badge{font-size:12px;background:#0c1130;border:1px solid #24306b;padding:3px 8px;border-radius:999px}
    .actions{display:flex;gap:6px;flex-wrap:wrap}
    .note{font-size:12px;color:var(--muted)}
    .footer{position:fixed;bottom:0;left:0;right:0;background:rgba(15,18,32,.9);backdrop-filter:blur(8px);padding:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>📚 Manga / Manhwa Tracker <span class="muted">(PWA)</span></h1>
      <div class="muted">Sleduj rozčtené série, pokračuj, označ dočtené. Funguje offline.</div>
      <div class="row" id="installRow" style="display:none;margin-top:8px">
        <button id="btnInstall">➕ Nainstalovat aplikaci</button>
      </div>
    </header>

    <section class="card">
      <input id="title" placeholder="Název série" />
      <input id="template" placeholder="URL šablona (např. https://manga.com/chapter/{n})" />
      <input id="lastUrl" placeholder="Poslední URL (pokud nemáš šablonu)" />
      <input id="chapter" type="number" placeholder="Kapitola" />
      <select id="status"><option value="reading">Čtu</option><option value="paused">Pozastaveno</option><option value="finished">Dočteno</option></select>
      <button onclick="addSeries()">Přidat</button>
    </section>

    <section id="list" class="grid"></section>
    <div class="footer"><div class="muted">Otevři v Safari → Sdílet → Přidat na plochu (nebo v Chrome → Nainstalovat).</div></div>
  </div>

<script>
const KEY='manga_tracker_v1';let items=[];
function save(){localStorage.setItem(KEY,JSON.stringify(items));}
function load(){try{items=JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){items=[]}}
function uid(){return Math.random().toString(36).slice(2)}
function addSeries(){const t=title.value.trim(),tpl=template.value.trim(),u=lastUrl.value.trim(),c=Number(chapter.value)||0,s=status.value;if(!t)return alert('Zadej název');if(!tpl&&!u)return alert('Vyplň URL');items.unshift({id:uid(),title:t,template:tpl||undefined,lastUrl:u||undefined,chapter:c,status:s,updated:Date.now()});save();render();}
function removeItem(id){if(!confirm('Odebrat sérii?'))return;items=items.filter(x=>x.id!==id);save();render();}
function makeUrl(it){return it.template?it.template.replace('{n}',String(it.chapter||0)):it.lastUrl||''}
function nextChapter(id){const it=items.find(x=>x.id===id);if(!it)return;it.chapter++;save();render();window.open(makeUrl(it),'_blank')}
function toggleFinished(id){const it=items.find(x=>x.id===id);it.status=it.status==='finished'?'reading':'finished';save();render();}
function render(){const list=document.getElementById('list');list.innerHTML='';items.sort((a,b)=>b.updated-a.updated).forEach(it=>{const c=document.createElement('div');c.className='card item';c.innerHTML=`<b>${it.title}</b><div>${it.status}</div><div class=\"actions\"><button onclick=\"window.open('${makeUrl(it)}','_blank')\">Otevřít</button><button onclick=\"nextChapter('${it.id}')\">+1</button><button onclick=\"toggleFinished('${it.id}')\">✔</button><button onclick=\"removeItem('${it.id}')\">🗑️</button></div>`;list.appendChild(c);})}
if('serviceWorker' in navigator){window.addEventListener('load',()=>navigator.serviceWorker.register('./service-worker.js'))}
let deferredPrompt;window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;installRow.style.display='block';});btnInstall.onclick=async()=>{deferredPrompt.prompt();await deferredPrompt.userChoice;installRow.style.display='none';};
load();render();
</script>
</body>
</html>
